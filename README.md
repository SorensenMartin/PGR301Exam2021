# PGR301Exam2021
PGR301 Exam for kandidat 2021

# Oppgave 1a

##### For at workflowen laget til denne oppgaven skal fungere hos andre, m√• man lage AWS access keys i IAM og legge dem til som secret eget repo. Da under navnene 
##### - AWS_ACCESS_KEY_ID og AWS_SECRET_ACCESS_KEY
##### Kan ogs√• v√¶re en ide og endre navn p√• bucket i denne delen av flowen til dette eksemplet:
      name: Deploy SAM Application
      if: github.ref == 'refs/heads/main' && github.event_name == 'push'
      run: sam deploy --no-confirm-changeset --no-fail-on-empty-changeset --stack-name kand2021 --capabilities CAPABILITY_IAM --region eu-west-1 --resolve-s3
##### --- --s3-bucket kand2021imagebucket üçé +++ --resolve-s3 üçè


[![SAM Build and Deploy if Main](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_sam.yml/badge.svg)](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_sam.yml)

###### Hva som har blitt gjort for √• endre koden til Kjell: 
- Endret hardkoding i app.py til √• lese BUCKET_Name
- Oppdatert template.yaml sin target bucket, samt lagt til noen policeies for tilganger som trengtes for dette
- Verifisert at det funker for meg i mitt Cloud9-milj√∏
- Lagt til workflow som bygger og deployer SAM aplikasjonen ved push p√• filer i /kjell katalogen. Om pushet ikke er p√• main, vil kun bygging skje og ikke deployment


#### Her ser vi at lambda funksjonen er opp √• g√•r med statuscode 200! üëç
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/81cd8e8b-1bfd-47b2-8dbe-c18a97fa83d0)
#### Her ser vi svaret etter at jeg la til et bilde fra en byggeplass (veldig relevant :) ) i min S3 Image bucket.
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/a39d204e-be4c-4ec2-a273-1c5b2ac45f83)


# Oppgave 1b

##### Var fors√•vidt ganske rett frem √• lage dockerfilen, men hadde noen problemer da det kom til √• vise resultatene. Fant ut at dette var p√•grunn av typen filer i kjellsimagebucket. Dette ble ogs√• addresert p√• canvas, men ser ut som at filene har klart √• lure seg inn igjenn p√• ett eller annent vis üòñ

##### Fikk f√∏rst dette svaret da jeg pr√∏vde √• kj√∏pre appen fra container.
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/a0a463be-9ac2-4c86-9668-6bbf8f129180)

##### La til en if statement som sjekket for fil ekstensjon f√∏r den ga respons via rekognition. Filtypene jeg har "godtatt" n√• er jpg og jpeg, men flere kan bildetyper kan legges til enkelt ved √• legge til flere or statements i app.py koden. Etter dette var gjort fikk jeg dette svaret n√•r jeg kj√∏rte denne koden i terminalen: 
docker build -t kjellpy .
docker run -e AWS_ACCESS_KEY_ID=XXX -e AWS_SECRET_ACCESS_KEY=YYY -e
BUCKET_NAME=kjellsimagebucket kjellpy
#### Result: 
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/111fccc0-431d-4371-8dde-f02ab98f6642)


# Oppgave 2a 

##### Fant ikke maven i mitt cloud9 milj√∏ til og starte med, s√• m√•tte installere manuelt fra nettsiden til apache maven. 
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/58d1de31-4833-4f53-98c4-c3e2d74d4efd)
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/43d07369-5db1-4851-9654-3b0320291a2d)

##### Etter dette hadde jeg fortsatt tr√∏bbel med at det l√• feil filformat i bucket, derfor la jeg til en file-ending check i RekognitionController.java som s√∏rger for at bare filer med jpg eller jpeg blir hentet ut! (Kan alltids legge til flere godkjente filtyper her ogs√• om √∏nskelig) Etter dette var gjort fikk jeg √∏nskelig resultat av curl kommanden.

![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/467924d9-41e4-4cec-9637-a535f9045512)

##### S√• testet jeg at dockerfilen fungerte (etter √• ha rotet med litt plassmangel som m√•tte ryddes i docker) og kj√∏rte dockerfilen. 
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/715ff4a4-c0b5-4452-94c6-67453e026663)
##### Fikk ogs√• her det samme resultatet av curl commandoen: 
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/234774fb-d6bd-4eef-9787-a22a98bf9b28)

# Oppgave 2b

##### ECR opprettet og workflow laget. Bygger p√• push til alle branches, men er man p√• main s√• pushes det ogs√• til ECR. Siste image har f√•tt latest p√• tag. 
[![Java CI/CD to AWS ECR](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_ecr_publish.yml/badge.svg)](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_ecr_publish.yml)

# Oppgave 3a

##### Endringer gjort p√• terraform koden til kjell er som f√∏lger:
###### Hardkoding av service name byttet til noe passende for meg: "edu-apprunner-service-kand-2021"
###### Alle "hardkodede" verdier har blitt byttet ut med var.ettellerannent slik at man enkelt kan endre variabler i eget variables.tf fil.

## S√∏kte i dokumentasjonen og fant dette: 

![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/9c73da3e-a3d6-4af5-98b1-c78064f23453)

## Endret da min konfigurasjon etter denne malen, noe som ser ut til √• ha funket fint: 

![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/70a0dfc8-11a9-4769-8183-8354abfbf269) 
      
###### Se main.tf med variables.tf for alle endringer gjort fra kjells orginale skript. 
###### Etter dette var gjort startet jeg en terraform for √• lage min egen IAM rolle for app runneren, samt kj√∏re fra mitt ECR fra tidligere oppgave.

# Oppgave 3b

##### Workflowen har blitt separert inn i to egen oppgaver, en for √• bygge og en for √• deploye image til ECR og terraform p√• main. Se Workflow: 2021_ecr_publish.yml
##### La ogs√• til i main.tf endringer for backend og aws terraform provider. Brukte her bucket fra tidligere √∏vinger pgr301-2021-terraform-state for √• lagre min state. 

### For at workflowen skal fungere p√• fork, er det noen ting man m√• gj√∏re. 
      - Som i oppgave 1a er det eneste som er uung√•elig at en fork m√• inneholde egene aws_access_key_id og aws_secret_access_key. 
      - S√• lenge disse n√∏kklene gir samme tilgang p√• aws som de jeg har blitt tildelt, skal det ikke v√¶re n√∏dvendig og endre noe annent for √• kj√∏re workflowen.
      - Om man vil, kan mann alltid endre variablene i variables.tf for √• bruke sitt eget ECR, Bucket, Apprunner eller annent. Men det jeg har laget fungerer da alts√• greit for andre med samme rettigheter.

##### Under kan man se flowen üëá
[![Java CI/CD to AWS ECR](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_ecr_publish.yml/badge.svg)](https://github.com/SorensenMartin/PGR301Exam2021/actions/workflows/2021_ecr_publish.yml)

# Oppgave 4a
![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/b1ee2c9f-8bc6-4bc0-b48e-40e141ca0e22)
## For denne oppgaven har jeg gjort om applikasjonen til √• v√¶re en service mitt sikkerhetsfirma tilbyr ulike byggeplasser!
##### Vernevokterene har f√•tt nye ting og bryne seg p√•, og et kamera fra ulike byggeplasser str√∏mmer daglig inn for sikkerhetssjekk! Endepunktene reflekterer s√∏k som daglig leder for byggeprosjektet har bedt oss v√¶re p√• utkikk etter!
##### Har for denne oppgaven lagt til to nye endepunkter. Begge bruker rekognition sin label detection, men til ulike hensikter. Under g√•r jeg igjennom alle endepuktene i applikasjonen, hva de gj√∏r, hvordan data som blir registrert og lagret som metrics i cloudwatch, og begrunnelse rundt alle valgene.
### OBS! Er ogs√• beskrivelse rundt valg og de ulike endepunktene i RekognitionController.java!!! 

# Endepunkt 1: Sjekker om arbeiderene har tatt p√• seg hjelmen sin f√∏r de g√•r inn p√• byggeplassen!

##### Dette endepunktet er for det mest uendret funksjonelt, men har byttet ut munnbeskyttelse med hjelm for det den skal s√∏ke etter. 
##### Metoden har f√•tt inn noen metrics, disse er som f√∏lger: 
#####      - Timer: Registrerer data p√• hvor lang tid API kallet bruker p√• √• f√• tilbake de ferdig sjekkede bildene.
#####      - Sjekker filene i bucket: Sjekker om noen av bildene tatt av sikkerhetskameraet er korrupte, som gir en indikasjon p√• helsen til hele systemt.

# Endepunkt 2: Sjekker om noen av arbeiderene pr√∏ver √• ta meg seg v√•pen inn p√• arbeidsplassen!

##### Dette endepunktet bruker som nevt tidligere rekognintion sin label detection, og skanner etter noen forh√•ndsdefinerte objekter som anses som farlige.
##### Trygghet p√• arbeidsplassen handler ikke bare om √• ikke f√• noe tungt i hodet, det handler ogs√• om √• ikke bli skutt av kollegaen din.
##### Metoden har f√•tt inn noen metrics, disse er som f√∏lger:
#####      - Timer: Ogs√• her en timer, livsviktig at sikkerhetsvaktene kan oppfatte farlige situasjoner fort, slik at de kan gj√∏re noe med det! Denne metoden b√∏r g√• enda fortere enn hjelm scan.
#####      - Counter for arbeidere scannet, samt om de hadde eller ikke hadde med v√•pen: Sjekker antall av arbeiderene som tar med farlig v√•pen p√• jobb.
#####      - Tank Detector: Byggeplassen hadde tidligere opplevd problemer med en arbeider som tok med en tanks p√• jobb. Derfor ville de ha en alarm om dette skulle skje igjen..

# Endepunkt 3: Sjekker om noen av arbeiderne har med seg substanser som vil gj√∏re arbeid p√• byggeplass farlig! ‚ò†

##### Dette endepunktet benytter seg ogs√• av label detection, men dette endepunktet sjekker om arbeiderene har med seg stoffer som alkohol og piller.
##### Edruelighet er en viktig faktor for at arbeidet p√• byggeplassen skal foreg√• p√• en trygg og forutsigbar m√•te! Man m√• kunne forholde seg til kollegaene sine p√• en ordentlig m√•te.
##### Metoden har f√•tt inn noen metrics, disse er som f√∏lger: 
#####      - Arraylist: Metoden holder en liste som legger inn alle de ulovlige substansene tatt med inn p√• arbeidet. Dette gj√∏r at man kan finne ut av hvem som har med ulovlige midler, samt sjekke hva som trender av ulovlige substanser blant de ansatte. 

# Cloudwatch dashbord

##### Med disse endepunktene og dataen som blir samlet opp, har jeg laget dette dashbordet for enkel oversikt over viktige sikkerhetshensyn: 

![image](https://github.com/SorensenMartin/PGR301Exam2021/assets/89515797/c9dbc4f0-e6b0-45ac-8d08-7278b46874d3)









